local assertEquals, assertAllAlmostEquals in MAD.utest
local loadtxt = require('loadtxt')

local data

Test_${suite} = {
  setUp = function (self)
    data = data or {
      mad = loadtxt(io.lines("${mad_file}")),
      ptc = loadtxt(io.lines("${ptc_file}")),
      madx = loadtxt(io.lines("${madx_file}")),
    }
  end,

  -- same output
  _testOrbit = function (self, actual, expected, margin)
    assertAllAlmostEquals(actual.s,  expected.s,  margin)
    assertAllAlmostEquals(actual.x,  expected.x,  margin)
    assertAllAlmostEquals(actual.px, expected.px, margin)
    assertAllAlmostEquals(actual.y,  expected.y,  margin)
    assertAllAlmostEquals(actual.py, expected.py, margin)
    assertAllAlmostEquals(actual.t,  expected.t,  margin)
    assertAllAlmostEquals(actual.pt, expected.pt, margin)
  end,

  test_PTC_v_MAD = function (self)
    self:_testOrbit(data.ptc, data.mad, ${ptc_margin})
  end,

  test_MADX_v_MAD = function (self)
    self:_testOrbit(data.madx, data.mad, ${madx_margin})
  end,

  test_PTC_v_MADX = function (self)
    self:_testOrbit(data.ptc, data.madx, ${madx_margin})
  end,
}
