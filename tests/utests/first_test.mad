MADX:open_env()

kqf  =  0.00872651312
ksf  =  0.0198492943
kqd  = -0.00872777242
ksd  = -0.039621283
kof  = 0.06

l_seq   = 70
l_omk   = 0
l_mult  = 0 
l_quad  = 2
l_sext  = 1.1
l_oct   = 0.5
lmbs    = 10.  -- arc length of dipole
amb     = 0.010   -- angle

factor    = amb / (2*sin(amb/2) ) 
lstraight = lmbs/factor           
--lmbr      =\ lstaight           
lmbr      = 10           

kmb = 0.03
mb_tilt  = 0.013

msol = 0.2


omk  = marker     'OMK' { l := l_omk }
qf   = quadrupole 'QF'  { l := l_quad, k1 := kqf }
qd   = quadrupole 'QD'  { l := l_quad, k1 := kqd }
sf   = sextupole  'SF'  { l := l_sext, k2 := ksf }
sd   = sextupole  'SD'  { l := l_sext, k2 := ksd }
of   = octupole   'OF'  { l := l_oct , k3 := kof }
qfm  = multipole  'QFM' { l := l_mult, knl = { 0.003, kqf * 3.1 * 0.2, -0.05 }, ksl ={0, 0.006}  }
mbs  = sbend      'SB'  { l:=lmbs, angle := amb, k0 := amb/lmbs,  k1=0.003, k2s=0.004 }
!mbs  = sbend      'SB'  { l:=lmbs, angle := amb, k0 := amb/lmbs,  k1=0.003, k2s=0.004 }
!mbs  = sbend      'SB'  { l:=lmbs, angle := amb, k0 := amb/lmbs,  k1=0.003, k2s=0.004 }
!mbs  = sbend      'SB'  { l:=lmbs, angle := amb, k0 := amb/lmbs, k0s = 0.05 }
mbr  = rbend      'RB'  { l:=lmbr, k0 := amb/lmbr } -- as mbs but rbend
sol  = solenoid    'SL' { l=0.5, ks := msol }




--[[*********************************************************************]]
--[[                 SEQUENCE                                            ]]
--[[*********************************************************************]]

ttt1 = sequence 'TTT1' { refer = 'centre', l = l_seq,
omk   'IP1'             { at= 0  },
!qf    'QF1'             { at= 0  },
!sf    'SF1'             { at= 6  },
!of    'OF1'             { at= 9  },
!qfm   'QFM1'            { at= 10  },
!qd    'QD1'             { at= 13  },
!sd    'SD1'             { at= 16  },
mbs   'SB1'             { at= 30  },
!mbr   'SR1'             { at= 20  },
!sol    'SL1'            {at= 60},
omk   'IP2'             { at= 70 },
}

MADX:close_env()