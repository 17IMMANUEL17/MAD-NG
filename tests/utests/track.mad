--[=[
 o-----------------------------------------------------------------------------o
 |
 | Track tests
 |
 | Methodical Accelerator Design - Copyright CERN 2015+
 | Support: http://cern.ch/mad  - mad at cern.ch
 | Authors: L. Deniau, laurent.deniau at cern.ch
 | Contrib: I. Tecker, irina.tecker at cern.ch
 |
 o-----------------------------------------------------------------------------o
 | You can redistribute this file and/or modify it under the terms of the GNU
 | General Public License GPLv3 (or later), as published by the Free Software
 | Foundation. This file is distributed in the hope that it will be useful, but
 | WITHOUT ANY WARRANTY OF ANY KIND. See http://gnu.org/licenses for details.
 o-----------------------------------------------------------------------------o

  Purpose:
  - Provide regression test suites for the track module.

 o-----------------------------------------------------------------------------o
]=]

-- locals ---------------------------------------------------------------------o

local assertNil, assertTrue, assertEquals in require 'luaunit'
local track, option, load in MAD

-- regression test suite ------------------------------------------------------o

TestTrack = {}

function TestTrack:testTrackLHC()
  load 'lhc_as-built_gen'
  load 'lhc_as-built_set'
  load 'lhc_uvar_gen'
  load 'opt_inj_gen'

  local lhcb1, lhcb2 in MADX
  assertEquals(#lhcb1, 6675)
  assertEquals(#lhcb2, 6674)

  local fmt = option.format
  option.format = "%-18.10g" -- MAD-X default output

  local tbl = track { sequence=lhcb1 }
  assertEquals(#tbl, 13267)
  tbl:write('track', {'name', 's', 'length', 'x', 'px', 'y', 'py', 't', 'pt'})
  tbl:write('track_all')

  option.format = fmt
 end

-- function TestTrack:setUp() end
-- function TestTrack:tearDown() end

function TestTrack:testTrack01()
  load'first_test'

  local ttt1 in MADX
  print("Here we are, first test of MAD-NG Physics")

  local fmt = option.format
  option.format = "%-18.10g" -- MAD-X default output

  local tbl = track { sequence=ttt1, X0= {1e-4,0 ,1e-4,0,0,1e-6}}
  tbl:write('track', {'name', 's', 'length', 'x', 'px', 'y', 'py', 't', 'pt'})
  tbl:write('track_all')

  option.format = fmt
end

-- end ------------------------------------------------------------------------o
