--[=[
 o-----------------------------------------------------------------------------o
 |
 | Plot module DEMO
 |
 | Methodical Accelerator Design - Copyright CERN 2016+
 | Support: http://cern.ch/mad  - mad at cern.ch
 | Authors: L. Deniau, laurent.deniau at cern.ch
 |          A.Z. Teska, aleksandra.teska at cern.ch
 | Contrib: -
 |
 o-----------------------------------------------------------------------------o
 | You can redistribute this file and/or modify it under the terms of the GNU
 | General Public License GPLv3 (or later), as published by the Free Software
 | Foundation. This file is distributed in the hope that it will be useful, but
 | WITHOUT ANY WARRANTY OF ANY KIND. See http://gnu.org/licenses for details.
 o-----------------------------------------------------------------------------o
]=]

-- locals ---------------------------------------------------------------------o

local beam, survey, track, option, plot in MAD

-- LHC
local function loadLHC()
  assert(require 'lhc_as-built_gen')
  assert(require 'lhc_as-built_set')
  assert(require 'lhc_undefvar'    )
  assert(require 'opt_inj_gen'     )

  local assertEquals in MAD.utest
  local lhcb1, lhcb2 in MADX
  assertEquals(#lhcb1, 6677)
  assertEquals(#lhcb2, 6676)
  return lhcb1, lhcb2
end

local lhcb1 = loadLHC()
local lhcb1_suv = survey { sequence=lhcb1 }

lhcb1_suv:write 'lhcb1_suv.tfs'

local beam450   = beam  { particle='proton', energy=450 }
local lhcb1_trk = track { sequence=lhcb1, beam=beam450 }

lhcb1_trk:write 'lhcb1_trk.tfs'

-- to display

plot {
  table = lhcb1_suv,
  haxis  = 'x',
  vaxis  = 'z',
  hmargin = 0.3,
  pointsizes = {z=0.1},
}

plot {
  sequence = lhcb1,
  table = lhcb1_trk,
  haxis = 's',
  vaxis = {'x','y'},
  range = {'E.DS.L5.B1','S.DS.R5.B1'},
  id = 2,
}

-- to filenames

plot {
  table = lhcb1_suv,
  haxis  = 'x',
  vaxis  = 'z',
  hmargin = 0.3,
  pointsizes = {z=0.1},
  filename = "lhcb1_IP5.pdf",
}

plot {
  sequence = lhcb1,
  table = lhcb1_trk,
  haxis = 's',
  vaxis = {'x','y'},
  range = {'E.DS.L5.B1','S.DS.R5.B1'},
  filename = "lhcb1_IP5.pdf",
}
