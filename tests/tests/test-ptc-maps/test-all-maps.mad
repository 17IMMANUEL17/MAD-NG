-- ../mad test-ptc-maps.mad
-- assume ../madx64 to be present...

local object                                                    in MAD
local tblcat                                                    in MAD.utility
local run_test in require("trackvsptc")
local lfs = MAD.filesys
local success = true

-- The setup for the tests ----------------------------------------------------o

local ref_cfg = object "ref" {
  -- How to run the tests
  dorun  = true, -- Default: true 
  dosave = true, -- Default: false
  doprnt = false, -- Default: false
  dodbg  = false, -- Default: false
  doplot = false,-- Default: false
  
  -- list of variables in the tests
  alist = {"model", "energy", "method", "nslice", "x0i"}, --attributes list
  tol = 1000,

  -- list of values that are used to run test but are not changed throughout
  order  = 4,        -- 2/4
  icase  = 56,       -- 56/6
  debug  = 0,        -- 0/6
  snm    = -1,
  seql   =  2,

  x0i    = 1..5,       -- 0, 4D, 5D, 5D strong, 6D (see get_mad_str)
}

-------------------------------------------------------------------------------o

--[[
  Time to run the tests:
  test-electric-maps.mad  - 51 mins
  test-sbend-maps.mad     - 10 mins
  test-quad-maps.mad      - 20 min
  test-sextupole-maps.mad - 20 min
  test-misc-maps.mad      - 10 min
]]

-- TODO: force ref_cfg to override the values in each file. 

for file in lfs.dir(".") do 
  if file:sub(1, 4) == "test" and file:sub(6, 8) ~= "all" then
    print("Running test: ", file)
    require(file:sub(1, -5))
  end
end